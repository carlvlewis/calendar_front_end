!function(e,t,a,n){"use strict";function r(e){return t.getElementById(e).innerHTML}function o(e){return e.toLowerCase().split(" ").join("-")}function i(e){return e.map(function(e){return{title:e.title,start:moment(e.start_date),end:moment(e.end_date),organizer:e.organizer,url:e.url,editable:!1,startEditable:!1,durationEditable:!1,className:o(e.organizer)}})}function l(e){return e.replace(/(https?:\/\/[^\s]+)/g,'<a href="$1">$1</a>')}function d(e,t){return e.filter(function(e){var a=moment(e.start_date),n=moment(e.end_date);return a.dayOfYear()===t.dayOfYear()||n.dayOfYear()===t.dayOfYear()?!0:a.dayOfYear()<=t.dayOfYear()&&n.dayOfYear()>=t.dayOfYear()?!0:!1})}function s(e){var t,a=moment(e.start_date),n=moment(e.end_date);return t=a.format("L")===n.format("L")?a.fromNow()+" | "+a.format("L"):a.format("L")+" - "+n.format("L"),{title:e.title,organizer:e.organizer,dateString:t,location:e.location,description:l(e.description)}}function c(){var e=t.documentElement.clientWidth;650>e?m.$listingTab.tab("show"):m.$calendarTab.tab("show")}var h={EVENTS:"http://localhost:3000/api/v1/events?page=1&page_count=50",NEW_EVENT:"https://boston-civic-calendar.herokuapp.com/events/new"},u=new Date,f=a(t),m={$tooltips:a('[data-toggle="tooltip"]'),$newSourceLink:a('[data-hook="new-event-link"]'),$main:a("[data-hook=main]"),$eventsPanel:a("[data-hook=events-panel]"),$errorPanel:a("[data-hook=error-panel]"),$calendarList:a('[data-hook="list-container"]'),$calendar:a('[data-hook="calendar-container"]'),$calendarDetail:a('[data-hook="calendar-detail"]'),$calendarDetailList:a('[data-hook="calendar-detail-events-list"]'),$hideDetail:a('[data-hook="hide-detail"], [data-hook="pane-dim"]'),$listingTab:a('[data-toggle="tab"][href="#listing"]'),$calendarTab:a('[data-toggle="tab"][href="#calendar"]')},v={calendarList:n.template(r("calendar-list"))};m.$tooltips.tooltip(),m.$newSourceLink.attr("href",h.NEW_EVENT),a.getJSON(h.EVENTS).error(function(e){console.log(e),m.$errorPanel.removeClass("hidden")}).done(function(e){m.$eventsPanel.removeClass("hidden");var t=i(e);m.$calendar.fullCalendar({events:t,theme:!1,aspectRatio:2,header:{left:"title",center:"month,agendaWeek,agendaDay",right:"today prev,next"},dayClick:function(t){var a=d(e,t);f.trigger("calendarDetail:show",{events:a})},eventClick:function(t){var a=d(e,t._start);return f.trigger("calendarDetail:show",{events:a}),!1},eventMouseover:function(e){a(this).tooltip({title:e.title+" <br/> "+e.organizer,html:!0}),a(this).tooltip("show")},eventMouseout:function(){a(this).tooltip("hide"),a(this).tooltip("destroy")}});var r=n.chain(e).filter(function(e){return moment(u).isBefore(e.start_date)}).sortBy("start_date").value(),o={events:n.map(r,s)},l=v.calendarList(o);m.$calendarList.append(l)}),f.on("calendarDetail:show",function(e,t){var a={events:n.map(t.events,s)};if(a.events.length){var r=v.calendarList(a);m.$calendarDetailList.html(r),m.$calendarDetail.removeClass("hidden")}}),f.on("calendarDetail:hide",function(){m.$calendarDetail.addClass("hidden")}),m.$hideDetail.on("click",function(){f.trigger("calendarDetail:hide")}),a(e).on("load resize",n.debounce(function(){c()},500))}(window,document,$,_);